# Multiple View Geometry

## Chapter 1 Introduction
この本のメインアイディアについての導入について説明する
具体的な内容についてはchapter 2以降を参照

### 1.1 The ubiquitous projective geometry
射影変換を行ったときに維持される幾何学特性は形状や長さ、角度などは保存されないが、**直線性**は維持されている。この変換を行った時に保存される性質について考える事が射影幾何である

射影幾何について学ぶ前に、まず**ユークリッド幾何**の問題点について理解する必要がある。
ユークリッド幾何ではオブジェクトの形状や角度を説明できるが、この幾何の基本コンセプトについて面倒な例外が生じてしまう。例えば、大体の相異なる2つの線は大抵どこかの一点で交わるが、線が平行になっていると交わらない場合がある。
そこで、ユークリッド空間を平行線が交わる無限遠の点があるという考え方で拡張することで、良く知られているユークリッド空間から**射影空間**に変換することができる。
射影空間の概念は、相異なる2本の直線は無限遠の点でも交わることがあるというユークリッド空間を拡張したものに過ぎないので、ユークリッド空間の距離、角度、点、線、入射などの性質をそのままに考える事ができる非常に有用な概念である。


ユークリッド平面は$(x,y)$の二つの座標のペアで点を表現していたが、射影平面ではその座標に1を加えた$(x,y,1)$の三つの座標のペアで同じ座標を表現する。
何故1をつけたかというとその方が便利だからである。射影空間においてはある座標を0ではない数で定数倍した座標$(kx,ky,k)$と$(x,y,1)$を同じ点として表現する。これを**同次座標系(homogeneous coordinates)** といい、共通の倍数だけ異なる二つの点は等価として表すことができる。これを考えた時に付け加える座標を1にすると、座標$(kx,ky,k)$が得られた時、kで割ることで元の$(x,y)$の座標をすぐに得ることが可能であるという点で便利である。
この際に$(x,y,0)$に相当する点は$(x / 0, y / 0)$はとなり無限となることから、無限遠点はこのように表現される

ユークリッド空間ではすべての点は同じで区別されない。ある1点が原点として選ばれているように見えるが、別の点を原点とした平面の座標の取り方もすることが可能である。言い換えると、空間そのものを別の点に移動したり、回転させることが可能である。この操作は**ユークリッド変換**という。ユークリッド変換では平行移動と回転のみで物質の形状や角度などは保存される。
この操作に加えて、**線形変換**の拡大・縮小、鏡映、せん断などの操作を含めた変換を**アフィン変換**と呼ばれている。
無限遠点については、ユークリッド変換やアフィン変換を行っても無限遠点のままである。ユークリッド空間においては、これらの点は何らかの方法で保存されて区別されるが、射影空間においてはユークリッド空間の他の点と変わらない。無限遠点は最後の座標の0である別の座標に変換される。
また、射影空間においてもユークリッド空間同様に線形変換は行列と座標の乗算によって表現できる。
n次元の射影空間での射影変換は変換行列を$H$、同次座標を$X$とすると以下の式で表される

$X^{'} = H_{(n+1) \times (n+1)}X$

コンピュータビジョンおいて射影空間は現実の3次元空間や画像を表現するのに便利である。
実際の世界や画像においては無限遠点は存在しないため、どうしても我々は無限遠の直線や平面を特別であると認識しているが、実際問題を解くのに有用である。都合のいい時に射影空間内のすべての点を同一として扱ったり、逆に無限平面や線を特別に見るようにして扱う

#### 1.1.1 Affine and Euclidean Geometry
射影空間は無限遠点を追加することでユークリッド空間から得られるが、逆のプロセスについて考える。

射影空間は平行線は無限遠点で交わり、無限遠の点においても他の点と同じとして扱うので平行線の概念がない。
そこで、白紙の空間が無限大に広がって射影空間を想像する。見ているのは空間のほんの一部で通常のユークリッド空間の一部とよく似ている。そしてこの空間に直線を引き、これを無限遠の線と定義する。次にこの区別線で交差する別の2本の線を引く。これらの2本の線は無限遠の線上で交差をしていることから平行線として定義する。この状況は無限平面を見た時に見えるものに似ている。例えば海の写真を撮った時、無限遠の点は画像の水平線として現れる。これらの無限遠の点は世界平面と対応が取れないように思えるが、この線をカメラの後方まで伸ばしていくと、カメラの後方で世界平面と交差する。したがって、世界平面と無限遠点は1対1の対応関係にある。世界平面における無限遠点は画像内の水平線と対応しており、世界平面における平行線は水平線と交差する。私たちの観点からは世界平面とそのイメージは射影平面の幾何学的な見方の代替法にすぎず、それに加えて区別線がある。射影平面の幾何学と区別線は **アフィン幾何(affine geometry)** として知られており、一方の空間の区別線を別の空間の区別線に移す射影変換をアフィン変換として知られている.
　無限遠の線を特定することで、その平面の直線の平行性を定義することができるようになる。平行を定義できるようになると、また他の概念の意味も持たせることができるようになる。
例えば、ABCDの4点があり、ABとCDが平行だとする。もしACとBDも平行だとすると、区間ABとCDの長さが等しいと定義することができる。同様に、同一直線上の2つの区間は、平行線上に両区間に等しい別の区間が存在すれば等しい。

射影平面に無限遠線を決めることによって、平行の概念を定義でき、それをアフィン幾何とした。アフィン幾何は特定の線を無限遠線と決める射影幾何の特殊版である。次にユークリッド幾何に立ちかえり,無限遠における直線や平面から特別な特徴を特定することで、アフィン幾何からユークリッド幾何にすることを考える。そうすることで、本書で最も重要な概念の一つである **絶対円錐曲線 (absolute conic)** の導入となる。
 まず2次元の円から考える。まず、アフィン幾何には円の概念がないことに注意する必要がある。平面を任意に引き延ばすと無限遠の直線は維持されるが、円は楕円に変わってしまう。つまり、アフィン変換において、円と楕円の区別なはい。
　しかし、ユークリッド幾何において区別され、重要な違いがある。代数的に、楕円は2次方程式で表される。そのため、二つの楕円が最も一般的には4点で交差することは予想されることであり、事実である。しかし、円の場合二つ以上の点で交差することはない。何故円同士は二つの交差点しか持たないのか、これは2つの円が複素数点において交点が存在するということである。
　同次座標$(x,y,w)$における円の方程式は以下のようになる

$(x-aw)^2 + (y - bw)^2 = r^2w^2 $

これは中心が$(x_0,y_0,w_0)^T = (a,b,1)^T$ で表される円を表している。$(x,y,w)^T = (1,\pm i ,0)^T$などの点ですぐに検証できる。興味深いことにすべての円は$(x,y,w)^T = (1,\pm i ,0)^T$ を通過しており、このことから任意の二つの円の交点となっていることが分かる。最後の要素が0であることからこの点は無限遠に存在しており,これを**無限遠の円形の点(circular points)** と呼ぶ。これらの点は複素数であり、$x^2 + y^2 = 0; w = 0$を満たす。

 これらの観察からユークリッド幾何を定義する手掛かりが得られた。ユークリッド幾何は射影幾何から無限遠線を選び、その線上のcircular pointsを選ぶことで変換でき、そうすることで二つのcircular pointsを通る任意の円錐を円として定義することができる。標準のユークリッドにおいてはcircular pointsは$(1,\pm i ,0)^T$ だが、射影平面に対して、ユークリッドの構造を割り当てる場合には任意の直線とその直線上の任意の2点を、無限遠の線とcircular pointsとして指定することが可能である。

　この視点を適応する例として、一般的な2次方程式$ ax^2 + by^2 + ... + fw^2 = 0$ の係数の数から分かるように、平面上の任意の5点を通る一般的な2次曲線が見つかることに注目する。一方で円はcircular pointsの2点と他の3点によって定義されるため、2次曲線同様、一意に指定するためには5点を必要とする。
　二つのcircular pointsから一つに絞った結果として、おなじみのユークリッド幾何学の全体像が得られることを驚くことではない。特に角度、縦横比のような概念はcircular pointsの観点で定義づけられる。しかし、これらの概念はユークリッド平面の座標系の観点からもっと簡単に定義ができる。

ここまで、無限遠の線と二つのcircular pointsを特定することで、射影平面の観点でユークリッド平面がどのように定義づけられているについて見てきた。同じような考え方を3次元のユークリッド幾何にも適用してみる。2次元と同様、二つの球がどの様に交わるかを考えてみる。2つの球体は一般的な4時曲線ではなく、一般的な楕円体がそうであるように円の中で交わる。この考え方は同時座標$(X,Y,Z,T)^T$ において全ての球が無限遠の平面と$X^2 + Y^2 + Z^2 = 0; T = 0$ で表される曲面で交わるという発見につながる。交わる線は無限平面上にある2次曲線であり、複素数の点のみで構成されている。これを**絶対円錐曲線(absolute conic)** といい,この本の重要なジオメトリの一つで特に**カメラキャリブレーション**と関係があるため、よくチェックすること

absolute conicはユークリッド座標系においてのみ、上記の式で定義される。一般的に3次元ユークリッド空間は特定の平面を無限平面として、その平面上の特定の2次曲線を絶対円錐曲線とすることによって射影空間から派生したものと考える。これらの実態は射影空間の座標系という観点で極めて一般的な記述法を持つかもしれない.

absolute conicがユークリッド幾何をどのように決定づけるかについてはここでは詳しく触れない。
一つ例を挙げると、空間における直線の垂直性はアフィン幾何では有効な概念ではなく、ユークリッド幾何に属しており、absolute conicを用いて次のように定義ができる。

>無限平面まで直線を延長すると。二つの直線の方向と呼ばれる二つの点が得られる。直線の垂直性はabsolute conicに対する2つの方向の関係で定義される。例えば、二つの方向がabsolute conicに対して共役点であれば直線は垂直であると言える. 簡単に言うと、absolete conicが3×3の対称行列$Ω_∞$で表されて、方向が点$d_1,d_2$である場合、$d1^TΩ_∞d2^T=0$を満たす場合に領野は共役である

詳しくは別の章を参照

### 1.2 Camera projections
この本の主題の一つが画像の形成プロセス、すなわち、3次元世界の2次元表現の形成と画像に現れるものの3次元構造を推測することである。
3次元世界から2次元画像に落とし込むことは、1つ次元を落とす射影のプロセスである。このプロセスをモデル化する一般的な方法は**中心投影**で3D空間上の点から空間上の投影中心の点にを通って光線を通り3D世界の点から引き出される。光線は特定の平面を通過し、その平面を通過した光線は画素となる。このモデルはカメラのレンズを通過してフィルムやセンサに衝突して画像を生成するカメラのモデルと同じである。レンズの厚みや焦点などを考慮しなければ、すべての光線がレンズの中心を通るという妥当な近似である。

射影空間に画像処理を適用するにあたり、3次元射影空間としてモデル化するのが慣例である。同様に、画像のモデルは2次元射影空間である。中心投影は3次元から2次元に射影である。カメラ中心を原点$(0,0,0,1)\top$とした同時座標系$(X,Y,Z,T)^\top$の観点で表現される3次元射影空間の点を考えた時、$X,Y,Z$を固定して、$T$を変化させた場合のすべて点$(X,Y,Z,T)\top$の集合は投影の中心をとおる1本の光線を形成して、全て同じ点に写像されることが分かる。つまり、$(X,Y,Z,T)$の最終的な座標はその点がどこに写像されるかに関与しない。したがって、この写像はブロック行列$P = [I_{3 \times 3} \vert O_3]$($I_{3 \times 3}$は単位行列、$O_3$は3次元のゼロベクトル) の構造を持つ$ 3\times 4$の行列$P$で表現される。
投影中心や画像内の座標のずれを考慮すると、画像投影は一般的にランク3の$ 3\times 4$の行列$P$によって表現される。この行列は**カメラ行列(camera matrix)** として知られている

まとめると,空間内の点に対する射影カメラの作用は同時座標の線形写像で次のようにあらわすことができる。
$\begin{pmatrix} x \\ y \\ w \end{pmatrix} = P_{3 \times 4} \begin{pmatrix} X \\ Y \\ Z \\ T \end{pmatrix}$

更に言えばもしすべての点が平面にある場合(ここでは$Z=0$の平面にあるとする)、次元を減らして以下のように合わらすこともできる
$\begin{pmatrix} x \\ y \\ w \end{pmatrix} = H_{3 \times 3} \begin{pmatrix} X \\ Y \\ T \end{pmatrix}$

中心投影において、
